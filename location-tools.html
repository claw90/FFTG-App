<script>
  const netlifyFunctionURL = "https://YOUR-SITE-NAME.netlify.app/.netlify/functions/places";

  const locationDiv = document.getElementById("current-location");

  const saved = JSON.parse(localStorage.getItem("fftgLocation"));
  if (saved) {
    locationDiv.innerText = `ğŸ“ Updated!\nLatitude: ${saved.lat}, Longitude: ${saved.lon}`;
  } else {
    locationDiv.innerText = "No location saved yet.";
  }

  function getLocation() {
    locationDiv.innerText = "Getting your location...";

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const lat = position.coords.latitude.toFixed(6);
        const lon = position.coords.longitude.toFixed(6);
        localStorage.setItem("fftgLocation", JSON.stringify({ lat, lon }));
        locationDiv.innerText = `ğŸ“ Updated!\nLatitude: ${lat}, Longitude: ${lon}`;
      },
      (error) => {
        locationDiv.innerText = "Error: " + error.message;
      }
    );
  }

  async function getNearbyRestaurants() {
    const out = document.getElementById("live-results");
    const loc = JSON.parse(localStorage.getItem("fftgLocation"));

    if (!loc) {
      out.innerText = "No location saved.";
      return;
    }

    out.innerText = "Loading real restaurants...";

    try {
      const res = await fetch(`${netlifyFunctionURL}?lat=${loc.lat}&lon=${loc.lon}`);
      const data = await res.json();

      if (!data.results || data.results.length === 0) {
        out.innerText = "No results found.";
        return;
      }

      out.innerHTML = data.results.slice(0, 10).map(place => {
        const name = place.name;
        const rating = place.rating || "N/A";
        const price = place.price_level ? "ğŸ’²".repeat(place.price_level) : "ğŸ’²";
        return `${price} <strong>${name}</strong> â€“ â­ ${rating}`;
      }).join("<br><br>");
    } catch (err) {
      console.error(err);
      out.innerText = "Error getting restaurant data.";
    }
  }
</script>
